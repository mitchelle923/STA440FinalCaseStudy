---
title: "Temporal Patterns in Surgical Patient Outcomes"
author: "Mitchelle Mojekwu"
date: "2023-12-14"
output:
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
```

```{r data,  include = FALSE}
SurgeryTiming <- read.csv("~/STA 440/STA440FinalCaseStudy/SurgeryTiming.csv", row.names=NULL)
```

```{r packages,  include = FALSE}
#| echo: false
#| include: false
#| label: downloading-packages
#| message: false
library(tidyverse)
library(knitr)
library(stringr)
library(dplyr)
library(invgamma)
library(fitdistrplus)
library(cowplot)
library(coda)
library(bayesplot)
library(rstan)
library(Stat2Data)
suppressWarnings(library(kableExtra))
library(kableExtra)
library(caret)
library(glmnet)
library(pROC)
library(PRROC)
```

# Introduction

**Context and Background**

Since the rise of the coronavirus disease (COVID-19), there has been a surge in the concern of a complication in healthcare industries worldwide. The shortage of healthcare professionals has been an increasingly discussed topic among citizens and healthcare providers alike as millions of people experienced the threat of a global pandemic. In general, the scarcity of medical industry professionals has led to a decline in the quality and availability of care in hospitals. (Džakula and Danko, 2022 ) It is widely known and studied that insufficient amounts of sleep and extended work shifts risk negative impacts on one's cognitive and motor performance. (Alhola and Päivi, 2007 )Due to the risk of underperformance of healthcare workers, particularly surgeons, there has been a push to limit resident work hours to mitigate potential errors that may impact patients.

Given that the healthcare sector is one of high stakes that often demands medical professionals to work extensive shifts due to short staff and increased patient attendance, the risk of long work hours cannot be ignored. Furthermore, just as extended hours of work may lead to fatigue and a compromise in cognitive and physical tasks, typical workweek progression may lead to similar results. (Sessler et al., 2011) This study aims to address the association between multiple time-related factors and the resulting outcome of patients' operation cases.

These are the main objectives of this case study (Sessler et al., 2011):

1)  Is there any association between whether or not a patient's operation results in 30-day mortality and the hour in which the operation occurs? How about the day of the week?

2)  Is there any association between whether or not a patient experiences in-hospital complications and the hour in which the operation occurs? How about the day of the day of the week?

Answering these objectives will help healthcare industry leaders better understand the possible risks of further progression in time from morning to evening and Monday to Friday of surgical labor on patient operation outcomes.

**The Data**

The data for this study was collected and provided by the Cleveland Clinic Lerner Research Institute. The data is formatted as patient-level observations that comprise of 32,001 surgical patients from the Cleveland Clinic between January 2005 and September 2010. The data collection window consisted of the hours of 6 am to 7 pm during the work weekdays. The surgical procedures were limited to elective operations since urgent or semi-urgent procedures are often performed later in the workday even without being officially labeled as emergencies. The variables in the dataset are the patient's age, gender, race, ASA physical status, body mass index, United States Agency for Healthcare Research and Quality's Clinical Classifications Software (AHRQ-CCS) Procedure Category, Charlson Comorbidity Index, 30-Day Mortality Risk Stratification Index, In-Hospital Complications Risk Stratification Index, overall incidence of 30-day Mortality for each AHRQ-CCS procedure category, overall Incidence of In-hospital Complications for each AHRQ-CCS procedure category, operation hour, day of the week, month of the year, phase of the moon, whether or not the patient resulted in having 30-day mortality, whether or not the patient resulted in having in-hospital complications, and whether or not the patient has the following diseases/disorders: cancer, cardiovascular/cerebrovascular disease, dementia, diabetes, digestive disease, osteoarthritis, psychiatric disorder, pulmonary disease. (some variable definitions in Appendix)

**Exploratory Data Analysis**

```{r age, echo = FALSE}
age_mean <-as.character(round(mean(SurgeryTiming$age, na.rm = TRUE),2))
age_sd <- as.character(round(sd(SurgeryTiming$age, na.rm = TRUE),2))
age_stat <- paste(age_mean, "\u00B1",age_sd)
```

```{r gender, echo = FALSE}
SurgeryTiming <- SurgeryTiming %>% 
  mutate(gender = case_when(gender == "F" ~ "Female",
                               gender == "M" ~ "Male",
                               TRUE ~ "NA"))
#Male
genderM_ct <- SurgeryTiming %>% 
  filter(gender == "Male") %>% 
  count()
genderM_Pct <- SurgeryTiming %>% 
  filter(gender == "Male") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))

#Female
genderF_ct <- SurgeryTiming %>% 
  filter(gender == "Female") %>% 
  count()
genderF_Pct <- SurgeryTiming %>% 
  filter(gender == "Female") %>%
  summarize(Proportion = round((n() / nrow(SurgeryTiming)*100),2))

genderM_stat <- paste(as.character(genderM_ct),"(",as.character(genderM_Pct),"%)")
genderF_stat <- paste(as.character(genderF_ct),"(",as.character(genderF_Pct),"%)")
```

```{r race, echo = FALSE}
#Caucasian
raceC_ct <- SurgeryTiming %>% 
  filter(race == "Caucasian") %>% 
  count()
raceC_Pct <- SurgeryTiming %>% 
  filter(race == "Caucasian") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))

#African American
raceA_ct <- SurgeryTiming %>% 
  filter(race == "African American") %>% 
  count()
raceA_Pct <- SurgeryTiming %>% 
  filter(race == "African American") %>%
  summarize(Proportion = round((n() / nrow(SurgeryTiming)*100),2))

#Other
raceO_ct <- SurgeryTiming %>% 
  filter(race == "Other") %>% 
  count()
raceO_Pct <- SurgeryTiming %>% 
  filter(race == "Other") %>%
  summarize(Proportion = round((n() / nrow(SurgeryTiming)*100),2))

raceC_stat <- paste(as.character(raceC_ct),"(",as.character(raceC_Pct),"%)")
raceA_stat <- paste(as.character(raceA_ct),"(",as.character(raceA_Pct),"%)")
raceO_stat <- paste(as.character(raceO_ct),"(",as.character(raceO_Pct),"%)")
```

```{r asa status, echo = FALSE}
#1-2
asa_status12_ct <- SurgeryTiming %>% 
  filter( asa_status== "I-II") %>% 
  count()
asa_status12_Pct <- SurgeryTiming %>% 
  filter(asa_status== "I-II") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))

#3
asa_status3_ct <- SurgeryTiming %>% 
  filter(asa_status == "III") %>% 
  count()
asa_status3_Pct <- SurgeryTiming %>% 
  filter(asa_status == "III") %>%
  summarize(Proportion = round((n() / nrow(SurgeryTiming)*100),2))

#4-6
asa_status46_ct <- SurgeryTiming %>% 
  filter(asa_status == "IV-VI") %>% 
  count()
asa_status46_Pct <- SurgeryTiming %>% 
  filter(asa_status == "IV-VI") %>%
  summarize(Proportion = round((n() / nrow(SurgeryTiming)*100),2))

asa_status12_stat <- paste(as.character(asa_status12_ct),"(",as.character(asa_status12_Pct),"%)")
asa_status3_stat <- paste(as.character(asa_status3_ct),"(",as.character(asa_status3_Pct),"%)")
asa_status46_stat <- paste(as.character(asa_status46_ct),"(",as.character(asa_status46_Pct),"%)")
```

```{r bmi, echo = FALSE}
bmi_q1 <- as.character(quantile(SurgeryTiming$bmi, 0.25, na.rm = TRUE))
bmi_q3 <- as.character(quantile(SurgeryTiming$bmi, 0.75, na.rm = TRUE))
bmi_med <-as.character(median(SurgeryTiming$bmi, na.rm = TRUE))
bmi_stat <- paste(bmi_med, "[",bmi_q1,",",bmi_q3,"]")
```

```{r disease/disorder, echo = FALSE}
#DISEASES/DISORDERS: Patients that have said diseaese/disorder

#Cancer
cancer_ct <- SurgeryTiming %>% 
  filter(baseline_cancer== "Yes") %>% 
  count()
cancer_Pct <- SurgeryTiming %>% 
  filter(baseline_cancer== "Yes") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
cancer_stat <- paste(as.character(cancer_ct),"(",as.character(cancer_Pct),"%)")

#Cardiovascular/Cerebrovascular Disease
cvd_ct <- SurgeryTiming %>% 
  filter(baseline_cvd== "Yes") %>% 
  count()
cvd_Pct <- SurgeryTiming %>% 
  filter(baseline_cvd== "Yes") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
cvd_stat <- paste(as.character(cvd_ct),"(",as.character(cvd_Pct),"%)")

#Dimentia
dementia_ct <- SurgeryTiming %>% 
  filter(baseline_dementia== "Yes") %>% 
  count()
dementia_Pct <- SurgeryTiming %>% 
  filter(baseline_dementia== "Yes") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
dementia_stat <- paste(as.character(dementia_ct),"(",as.character(dementia_Pct),"%)")

#Diabetes
diabetes_ct <- SurgeryTiming %>% 
  filter(baseline_diabetes== "Yes") %>% 
  count()
diabetes_Pct <- SurgeryTiming %>% 
  filter(baseline_diabetes== "Yes") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
diabetes_stat <- paste(as.character(diabetes_ct),"(",as.character(diabetes_Pct),"%)")

#Digestive Disease
digestive_ct <- SurgeryTiming %>% 
  filter(baseline_digestive== "Yes") %>% 
  count()
digestive_Pct <- SurgeryTiming %>% 
  filter(baseline_digestive== "Yes") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
digestive_stat <- paste(as.character(digestive_ct),"(",as.character(digestive_Pct),"%)")

#Osteoarthritis
osteoart_ct <- SurgeryTiming %>% 
  filter(baseline_osteoart== "Yes") %>% 
  count()
osteoart_Pct <- SurgeryTiming %>% 
  filter(baseline_osteoart== "Yes") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
osteoart_stat <- paste(as.character(osteoart_ct),"(",as.character(osteoart_Pct),"%)")

#Psychiatric Disorder
psych_ct <- SurgeryTiming %>% 
  filter(baseline_psych== "Yes") %>% 
  count()
psych_Pct <- SurgeryTiming %>% 
  filter(baseline_psych== "Yes") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
psych_stat <- paste(as.character(psych_ct),"(",as.character(psych_Pct),"%)")

#Pulmonary Disease
pulmonary_ct <- SurgeryTiming %>% 
  filter(baseline_pulmonary== "Yes") %>% 
  count()
pulmonary_Pct <- SurgeryTiming %>% 
  filter(baseline_pulmonary== "Yes") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
pulmonary_stat <- paste(as.character(pulmonary_ct),"(",as.character(pulmonary_Pct),"%)")
```

```{r cci, echo = FALSE}
cci_q1 <- as.character(quantile(SurgeryTiming$baseline_charlson, 0.25, na.rm = TRUE))
cci_q3 <- as.character(quantile(SurgeryTiming$baseline_charlson, 0.75, na.rm = TRUE))
cci_med <-as.character(median(SurgeryTiming$baseline_charlson, na.rm = TRUE))
cci_stat <- paste(cci_med, "[",cci_q1,",",cci_q3,"]")
```

```{r rsi mortality, echo = FALSE}
mortality_rsi_q1 <- as.character(quantile(SurgeryTiming$mortality_rsi, 0.25, na.rm = TRUE))
mortality_rsi_q3 <- as.character(quantile(SurgeryTiming$mortality_rsi, 0.75, na.rm = TRUE))
mortality_rsi_med <-as.character(median(SurgeryTiming$mortality_rsi, na.rm = TRUE))
mortality_rsi_stat <- paste(mortality_rsi_med, "[",mortality_rsi_q1,",",mortality_rsi_q3,"]")
```

```{r rsi complications, echo = FALSE}
complication_rsi_q1 <- as.character(quantile(SurgeryTiming$complication_rsi, 0.25, na.rm = TRUE))
complication_rsi_q3 <- as.character(quantile(SurgeryTiming$complication_rsi, 0.75, na.rm = TRUE))
complication_rsi_med <-as.character(median(SurgeryTiming$complication_rsi, na.rm = TRUE))
complication_rsi_stat <- paste(complication_rsi_med, "[",complication_rsi_q1,",",complication_rsi_q3,"]")
```

The initial stages of exploratory data analysis consisted of viewing the distribution of each of the patient descriptor potential predictors. The distribution of age, gender, race, ASA Physical status, and body mass index (Appendix: Images 1-5 ) assisted in identifying the best measure of center and spread for summary statistics.

### Summary Statistics of Baseline Risk Factors for Patients

```{r table1, echo = FALSE}
table1 <- data.frame(
  Predictors = c("Age", "Male", "Female", "Caucasian", "African American", "Other", "I-II", "III", "IV-VI", "Body Mass Index", "Cancer", "Cardiovascular/cerebrovascular disease", "Dementia", "Diabetes", "Digestive disease","Osteoarthritis","Psychiatric disorder", "Pulmonary disease", "Charlson Comorbidity Index", "Risk Stratification Index (30-day mortality)", "Risk Stratification Index (in-hospital complications)"),
  "Summary Statistics" = c(age_stat, genderM_stat, genderF_stat, raceC_stat, raceA_stat, raceO_stat, asa_status12_stat,asa_status3_stat, asa_status46_stat, bmi_stat,cancer_stat, cvd_stat, dementia_stat, diabetes_stat, digestive_stat, osteoart_stat, psych_stat,pulmonary_stat, cci_stat,mortality_rsi_stat, complication_rsi_stat)
)
kable(table1, booktabs = TRUE) %>% 
  pack_rows(index = c("Age(mean/SD)" = 1, "Gender (count/%)" = 2, "Race (count/%)" = 3, "ASA Physical Status (count/%)" = 3, "BMI (median/IQR)" = 1, "Diseases/Disorders (count/%)" = 8, "Indexes (median/IQR)" = 3)) %>% 
  kable_styling(font_size = 6, latex_options = "HOLD_position")
```

Based on the visualizations and the summary statistics above it is noteworthy that the age of the patients is normally distributed centered around 57.66 years old, there are more female patients, and the racial demographic of the patients is largely Caucasian. The patients tend to be centered more around the lower to middle class of ASA physical status meaning they are mostly in relatively good health. The BMI of the patients is normally distributed but slightly skewed towards higher BMI with a center at 28.19 which is relatively overweight. It is also worth noting that roughly half the patient population has a cardiovascular or cerebrovascular disease, about a third of the patients have cancer, and about a fifth of the patients have a digestive disease. The median Charlson Comorbidity Index of the patient population is roughly 0. This means no comorbidities were found and therefore generally there wasn't more than one disease simultaneously found in one patient. Overall, certain demographics of the patients are quite atypical in comparison to the general population.

```{r hour, echo=FALSE}
#bin time into hours (6-19)
SurgeryTiming$hour_binned <- factor(sub("([0-9]+).[0-9]+", "\\1", as.character(SurgeryTiming$hour)))

hr6_ct <- SurgeryTiming %>% 
  filter(hour_binned== "6") %>% 
  count()
hr6_Pct <- SurgeryTiming %>% 
  filter(hour_binned== "6") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
hr6_stat <- paste(as.character(hr6_ct),"(",as.character(hr6_Pct),"%)")

hr7_ct <- SurgeryTiming %>% 
  filter(hour_binned== "7") %>% 
  count()
hr7_Pct <- SurgeryTiming %>% 
  filter(hour_binned== "7") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
hr7_stat <- paste(as.character(hr7_ct),"(",as.character(hr7_Pct),"%)")

hr8_ct <- SurgeryTiming %>% 
  filter(hour_binned== "8") %>% 
  count()
hr8_Pct <- SurgeryTiming %>% 
  filter(hour_binned== "8") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
hr8_stat <- paste(as.character(hr8_ct),"(",as.character(hr8_Pct),"%)")

hr9_ct <- SurgeryTiming %>% 
  filter(hour_binned== "9") %>% 
  count()
hr9_Pct <- SurgeryTiming %>% 
  filter(hour_binned== "9") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
hr9_stat <- paste(as.character(hr9_ct),"(",as.character(hr9_Pct),"%)")

hr10_ct <- SurgeryTiming %>% 
  filter(hour_binned== "10") %>% 
  count()
hr10_Pct <- SurgeryTiming %>% 
  filter(hour_binned== "10") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
hr10_stat <- paste(as.character(hr10_ct),"(",as.character(hr10_Pct),"%)")

hr11_ct <- SurgeryTiming %>% 
  filter(hour_binned== "11") %>% 
  count()
hr11_Pct <- SurgeryTiming %>% 
  filter(hour_binned== "11") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
hr11_stat <- paste(as.character(hr11_ct),"(",as.character(hr11_Pct),"%)")

hr12_ct <- SurgeryTiming %>% 
  filter(hour_binned== "12") %>% 
  count()
hr12_Pct <- SurgeryTiming %>% 
  filter(hour_binned== "12") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
hr12_stat <- paste(as.character(hr12_ct),"(",as.character(hr12_Pct),"%)")

hr13_ct <- SurgeryTiming %>% 
  filter(hour_binned== "13") %>% 
  count()
hr13_Pct <- SurgeryTiming %>% 
  filter(hour_binned== "13") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
hr13_stat <- paste(as.character(hr13_ct),"(",as.character(hr13_Pct),"%)")

hr14_ct <- SurgeryTiming %>% 
  filter(hour_binned== "14") %>% 
  count()
hr14_Pct <- SurgeryTiming %>% 
  filter(hour_binned== "14") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
hr14_stat <- paste(as.character(hr14_ct),"(",as.character(hr14_Pct),"%)")

hr15_ct <- SurgeryTiming %>% 
  filter(hour_binned== "15") %>% 
  count()
hr15_Pct <- SurgeryTiming %>% 
  filter(hour_binned== "15") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
hr15_stat <- paste(as.character(hr15_ct),"(",as.character(hr15_Pct),"%)")

hr16_ct <- SurgeryTiming %>% 
  filter(hour_binned== "16") %>% 
  count()
hr16_Pct <- SurgeryTiming %>% 
  filter(hour_binned== "16") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
hr16_stat <- paste(as.character(hr16_ct),"(",as.character(hr16_Pct),"%)")

hr17_ct <- SurgeryTiming %>% 
  filter(hour_binned== "17") %>% 
  count()
hr17_Pct <- SurgeryTiming %>% 
  filter(hour_binned== "17") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
hr17_stat <- paste(as.character(hr17_ct),"(",as.character(hr17_Pct),"%)")

hr18_ct <- SurgeryTiming %>% 
  filter(hour_binned== "18") %>% 
  count()
hr18_Pct <- SurgeryTiming %>% 
  filter(hour_binned== "18") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
hr18_stat <- paste(as.character(hr18_ct),"(",as.character(hr18_Pct),"%)")

hr19_ct <- SurgeryTiming %>% 
  filter(hour_binned== "19") %>% 
  count()
hr19_Pct <- SurgeryTiming %>% 
  filter(hour_binned== "19") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
hr19_stat <- paste(as.character(hr19_ct),"(",as.character(hr19_Pct),"%)")
```

```{r week edit, echo = FALSE}
SurgeryTiming <- SurgeryTiming %>% 
  mutate(dow = case_when(dow == "Mon" ~ "Monday",
                        dow == "Tue" ~ "Tuesday",
                        dow == "Wed" ~ "Wednesday",
                        dow == "Thu" ~ "Thursday",
                        dow == "Fri" ~ "Friday"))
```

```{r week, echo = FALSE}
dowMon_ct <- SurgeryTiming %>% 
  filter(dow== "Monday") %>% 
  count()
dowMon_Pct <- SurgeryTiming %>% 
  filter(dow== "Monday") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
dowMon_stat <- paste(as.character(dowMon_ct),"(",as.character(dowMon_Pct),"%)")

dowTue_ct <- SurgeryTiming %>% 
  filter(dow== "Tuesday") %>% 
  count()
dowTue_Pct <- SurgeryTiming %>% 
  filter(dow== "Tuesday") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
dowTue_stat <- paste(as.character(dowTue_ct),"(",as.character(dowTue_Pct),"%)")

dowWed_ct <- SurgeryTiming %>% 
  filter(dow== "Wednesday") %>% 
  count()
dowWed_Pct <- SurgeryTiming %>% 
  filter(dow== "Wednesday") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
dowWed_stat <- paste(as.character(dowWed_ct),"(",as.character(dowWed_Pct),"%)")

dowThu_ct <- SurgeryTiming %>% 
  filter(dow== "Thursday") %>% 
  count()
dowThu_Pct <- SurgeryTiming %>% 
  filter(dow== "Thursday") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
dowThu_stat <- paste(as.character(dowThu_ct),"(",as.character(dowThu_Pct),"%)")

dowFri_ct <- SurgeryTiming %>% 
  filter(dow== "Friday") %>% 
  count()
dowFri_Pct <- SurgeryTiming %>% 
  filter(dow== "Friday") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
dowFri_stat <- paste(as.character(dowFri_ct),"(",as.character(dowFri_Pct),"%)")
```

```{r month edit, echo = FALSE}
SurgeryTiming <- SurgeryTiming %>% 
  mutate(month = case_when(month == "Jan" ~ "January",
                        month == "Feb" ~ "February",
                        month == "Mar" ~ "March",
                        month == "Apr" ~ "April",
                        month == "May" ~ "May",
                        month == "Jun" ~ "June",
                        month == "Jul" ~ "July",
                        month == "Aug" ~ "August",
                        month == "Sep" ~ "September",
                        month == "Oct" ~ "October",
                        month == "Nov" ~ "November",
                        month == "Dec" ~ "December",
                               TRUE ~ "NA"))
```

```{r month, echo = FALSE}
monthJan_ct <- SurgeryTiming %>% 
  filter(month== "January") %>% 
  count()
monthJan_Pct <- SurgeryTiming %>% 
  filter(month== "January") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
monthJan_stat <- paste(as.character(monthJan_ct),"(",as.character(monthJan_Pct),"%)")

monthFeb_ct <- SurgeryTiming %>% 
  filter(month== "February") %>% 
  count()
monthFeb_Pct <- SurgeryTiming %>% 
  filter(month== "February") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
monthFeb_stat <- paste(as.character(monthFeb_ct),"(",as.character(monthFeb_Pct),"%)")

monthMar_ct <- SurgeryTiming %>% 
  filter(month== "March") %>% 
  count()
monthMar_Pct <- SurgeryTiming %>% 
  filter(month== "March") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
monthMar_stat <- paste(as.character(monthMar_ct),"(",as.character(monthMar_Pct),"%)")

monthApr_ct <- SurgeryTiming %>% 
  filter(month== "April") %>% 
  count()
monthApr_Pct <- SurgeryTiming %>% 
  filter(month== "April") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
monthApr_stat <- paste(as.character(monthApr_ct),"(",as.character(monthApr_Pct),"%)")

monthMay_ct <- SurgeryTiming %>% 
  filter(month== "May") %>% 
  count()
monthMay_Pct <- SurgeryTiming %>% 
  filter(month== "May") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
monthMay_stat <- paste(as.character(monthMay_ct),"(",as.character(monthMay_Pct),"%)")

monthJun_ct <- SurgeryTiming %>% 
  filter(month== "June") %>% 
  count()
monthJun_Pct <- SurgeryTiming %>% 
  filter(month== "June") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
monthJun_stat <- paste(as.character(monthJun_ct),"(",as.character(monthJun_Pct),"%)")

monthJul_ct <- SurgeryTiming %>% 
  filter(month== "July") %>% 
  count()
monthJul_Pct <- SurgeryTiming %>% 
  filter(month== "July") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
monthJul_stat <- paste(as.character(monthJul_ct),"(",as.character(monthJul_Pct),"%)")

monthAug_ct <- SurgeryTiming %>% 
  filter(month== "August") %>% 
  count()
monthAug_Pct <- SurgeryTiming %>% 
  filter(month== "August") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
monthAug_stat <- paste(as.character(monthAug_ct),"(",as.character(monthAug_Pct),"%)")

monthSep_ct <- SurgeryTiming %>% 
  filter(month== "September") %>% 
  count()
monthSep_Pct <- SurgeryTiming %>% 
  filter(month== "September") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
monthSep_stat <- paste(as.character(monthSep_ct),"(",as.character(monthSep_Pct),"%)")

monthOct_ct <- SurgeryTiming %>% 
  filter(month== "October") %>% 
  count()
monthOct_Pct <- SurgeryTiming %>% 
  filter(month== "October") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
monthOct_stat <- paste(as.character(monthOct_ct),"(",as.character(monthOct_Pct),"%)")

monthNov_ct <- SurgeryTiming %>% 
  filter(month== "November") %>% 
  count()
monthNov_Pct <- SurgeryTiming %>% 
  filter(month== "November") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
monthNov_stat <- paste(as.character(monthNov_ct),"(",as.character(monthNov_Pct),"%)")

monthDec_ct <- SurgeryTiming %>% 
  filter(month== "December") %>% 
  count()
monthDec_Pct <- SurgeryTiming %>% 
  filter(month== "December") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
monthDec_stat <- paste(as.character(monthDec_ct),"(",as.character(monthDec_Pct),"%)")
```

```{r moonphase, echo = FALSE}
newmoon_ct <- SurgeryTiming %>% 
  filter(moonphase== "New Moon") %>% 
  count()
newmoon_Pct <- SurgeryTiming %>% 
  filter(moonphase== "New Moon") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
newmoon_stat <- paste(as.character(newmoon_ct),"(",as.character(newmoon_Pct),"%)")

firstquart_ct <- SurgeryTiming %>% 
  filter(moonphase== "First Quarter") %>% 
  count()
firstquart_Pct <- SurgeryTiming %>% 
  filter(moonphase== "First Quarter") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
firstquart_stat <- paste(as.character(firstquart_ct),"(",as.character(firstquart_Pct),"%)")

fullmoon_ct <- SurgeryTiming %>% 
  filter(moonphase== "Full Moon") %>% 
  count()
fullmoon_Pct <- SurgeryTiming %>% 
  filter(moonphase== "Full Moon") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
fullmoon_stat <- paste(as.character(fullmoon_ct),"(",as.character(fullmoon_Pct),"%)")

lastquart_ct <- SurgeryTiming %>% 
  filter(moonphase== "Last Quarter") %>% 
  count()
lastquart_Pct <- SurgeryTiming %>% 
  filter(moonphase== "Last Quarter") %>%
  summarize(Percent = round((n() / nrow(SurgeryTiming)*100),2))
lastquart_stat <- paste(as.character(lastquart_ct),"(",as.character(lastquart_Pct),"%)")
```

### Summary Statistics of Case Frequencies (Count/%)

```{r table2, echo = FALSE}
table2 <- data.frame(
  Predictors = c("6:00", "7:00", "8:00", "9:00", "10:00","11:00","12:00","13:00", "14:00", "15:00", "16:00", "17:00", "18:00", "19:00", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday","January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December", "New Moon", "First Quarter", "Full Moon", "Last Quarter"),
  "Summary Statistics" = c(hr6_stat,hr7_stat,hr8_stat,hr9_stat,hr10_stat,hr11_stat,hr12_stat,hr13_stat,hr14_stat,hr15_stat,hr16_stat,hr17_stat,hr18_stat,hr19_stat,dowMon_stat,dowTue_stat, dowWed_stat,dowThu_stat,dowFri_stat,monthJan_stat, monthFeb_stat,monthMar_stat, monthApr_stat,monthMay_stat, monthJun_stat,monthJul_stat, monthAug_stat, monthSep_stat, monthOct_stat, monthNov_stat, monthDec_stat, newmoon_stat, firstquart_stat,fullmoon_stat,lastquart_stat)
)
kable(table2, booktabs = TRUE) %>% 
  pack_rows(index = c("Hour of Operation" = 14, "Day of the Week" = 5, "Month" = 12, "Phase of Moon" = 4)) %>% 
  kable_styling(font_size = 6, latex_options = "HOLD_position")

```

The table above as well as the Images 9-12 (Appendix) display the distribution of the patient's operations by measures of time. The distribution of operation cases by hour shows that a third of operation cases took place from 7-8 am and a steady flow of operation cases took place from 10 am to 2 pm. The distribution of operation cases over the days of the week, shows there are only slightly more cases at the beginning of the week. The distribution of cases over months has some differences with the highest concentrations being in August and September. Lastly, the distribution of operations over moon phases is quite uniform.

The last significant portion of EDA was visualizing the possible relationship between the time-related predictors and the response variables of whether or not a patient had in-hospital complications and 30-day mortality. Image 15A) shows that operations of patients that have 30-day mortality tend to happen slightly later in the day than operations of patients that do not have 30-day mortality. Image 15B) shows that operations of patients who have in-hospital complications tend to be relatively in the same range of time as operations of patients who do not have in-hospital complications. Image 16A) shows there is a noticeably decreasing number of patients without 30-day mortality as the week goes on. Image 16B) shows there is also a decreasing number of patients without in-hospital complications as the week goes on.

```{r, echo=FALSE}
fifteenA <- ggplot(SurgeryTiming, aes(x =mort30, y = hour,fill = mort30)) + geom_boxplot() + labs(title = "15A) Hour of Operation vs 30-Day Mortality", x = "30 Day Mortality", y = "Hour of Operation", fill = "30 Day Mortality") +theme(aspect.ratio = 1,legend.position = "none",
        plot.title = element_text(size = 6),
        plot.subtitle = element_text(size = 6),
        axis.text = element_text(size = 5),
        axis.title = element_text(size = 6))+coord_flip()
fifteenB <- ggplot(SurgeryTiming, aes(x =complication, y = hour,fill = complication)) + geom_boxplot() + labs(title = "15B) Hour of Operation vs In-Hospital Complication", x = "In-Hospital Complication", y = "Hour of Operation", fill = "In-Hospital Complication") +theme(aspect.ratio = 1,legend.position = "none",
        plot.title = element_text(size = 6),
        plot.subtitle = element_text(size = 6),
        axis.text = element_text(size = 5),
        axis.title = element_text(size = 6)) +coord_flip()
sixteenA <- ggplot(data=SurgeryTiming, aes(x=mort30,fill = mort30)) +
    geom_bar() + labs(title = '16A) Day of Operation vs 30-Day Mortality', x = '30-Day Mortality', y = 'Count', fill = "30 Day Mortality")+facet_wrap(~dow)+theme(aspect.ratio = 1,legend.position = "none",
        plot.title = element_text(size = 7),
        plot.subtitle = element_text(size = 6),
        axis.text = element_text(size = 5),
        axis.title = element_text(size = 6))

sixteenB <- ggplot(data=SurgeryTiming, aes(x=complication,fill = complication)) +
    geom_bar() + labs(title = '16B) Day of Operation vs In-Hospital Complication', x = 'In-Hospital Complication', y = 'Count', fill = "In-Hospital Complication")+facet_wrap(~dow)+theme(aspect.ratio = 1,legend.position = "none",
        plot.title = element_text(size = 7),
        plot.subtitle = element_text(size = 6),
        axis.text = element_text(size = 5),
        axis.title = element_text(size = 6))

plot_grid(fifteenA, fifteenB,sixteenA,sixteenB, ncol=2, rel_heights = c(0.7, 0.7))
```

# Methodology

**Model Choice: Logistic Regression Model**

To model the relationship between the measures of time (hour of the operation, day of the week) in which the surgical operations took place and the response variables of 30-day mortality and in-hospital complication, I decided to create two logistic regression models. The reason behind this choice is due to the response variables being two separate binary outcomes. I decided to utilize the variables that the research objective highlighted such as hour of operation and day of the week, but I also accounted for other variables. In both models, I added the patients' age, Body Mass Index, ASA Physical Status, and Charlson Comorbidity Index because these are predictors known to be associated with the general wellness and health complications of a person which would likely explain some variability in the response variables of 30-day mortality and in-hospital complication. In the logistic regression model with 30-day mortality as the response variable I accounted for the Risk Stratification Index (30-day mortality) to account for procedures and diagnoses the patient undergoes. This RSI allows the 30-day mortality outcome to be compared equally across institutions. This was also done in the logistic regression model with in-hospital complication as the response variable but instead, I accounted for the Risk Stratification Index (in-hospital complications). Additionally, in both models, I accounted for the overall incidence of the response variables for each AHRQ-CCS Procedure Category. This adjustment was implemented to guarantee thorough control for potential confounding factors linked to variations in the exposures of interest concerning the different procedure types of each patient. (Sessler, Daniel I., et al, 2011)

\pagebreak

***Model 1: 30-Day Mortality***

```{=latex}
\begin{equation*}
\begin{aligned}
log(\frac{\pi_i}{1-\pi_i}) &= \beta_0+\beta_1\times RSI \space Mortality_i+ \beta_2 \times OverallIncidence\space Mortality_i +\beta_3 \times hour_i \\&\quad  + \beta_4 \times (day_i = Monday)+ \beta_5 \times (day_i = Thursday)+ \beta_6 \times (day_i = Tuesday)+ \beta_7 \times (day_i = Wednesday) \\&\quad  +\beta_8 \times Age_i +\beta_9 \times BMI_i+ \beta_{10} \times (ASA\space status_i = I-II)+ \beta_{11} \times (ASA\space status_i = III) \\&\quad+  \beta_{12} \times (ASA \space status_i = IV-VI)  + \beta_{13} \times CCI_i+\epsilon_i
\end{aligned}
\end{equation*}
```
$\pi =$ probability of a patient having 30-day mortality

$where ~ Y_i|X_i\beta \sim Bernoulli(\pi_i) \space ~  and ~ \space \epsilon_i\sim N(0,\sigma)$

***Model 2: In-Hospital Complication***

```{=latex}
\begin{equation*}
\begin{aligned}
log(\frac{\pi_i}{1-\pi_i}) &= \beta_0+\beta_1\times RSI\space Complication_i+ \beta_2 \times OverallIncidence \space Complication_i +\beta_3 \times hour_i \\&\quad  + \beta_4 \times (day_i = Monday)+ \beta_5 \times (day_i = Thursday)+ \beta_6 \times (day_i = Tuesday)+ \beta_7 \times (day_i = Wednesday) \\&\quad  +\beta_8 \times Age_i +\beta_9 \times BMI_i+ \beta_{10} \times (ASA \space status_i = I-II)+ \beta_{11} \times (ASA \space status_i = III) \\&\quad + \beta_{12} \times (ASA \space status_i = IV-VI)  + \beta_{13} \times CCI_i+\epsilon_i
\end{aligned}
\end{equation*}
```
$\pi=$ probability of a patient having In-Hospital Complication

$where ~ Y_i|X_i\beta \sim Bernoulli(\pi_i) ~ \space and \space ~ \epsilon_i\sim N(0,\sigma)$

The coefficients are $\beta_0$ for the intercept, $\beta_1$ for the Risk Stratification Index (30-Day Mortality)/(In-Hospital Complication), $\beta_2$ for the Overall Incidence of 30-Day Mortality/In-Hospital Complication for Each AHRQ-CCS Procedure Category, $\beta_3$ for operation hour, $\beta_4$-$\beta_7$ for the days of the week with the baseline being Friday, $\beta_8$ for patients' age, $\beta_9$ for patients' body mass index, $\beta_{10}$-$\beta_{12}$ for ASA Physical Status,$\beta_{13}$ for Charlson Comorbidity Index, and $\epsilon_i$ for the residual error for the $i^{th}$ patient.

**Model Assumptions and Diagnostics**

The model assumptions needed to fit these models were linearity of the log odds, independence of the observations, absence of perfect multicollinearity, and the data being obtained from a random process. Image 17) shows there is linearity between the predictor hour of operation and the log odds of 30-day mortality. Image 18) shows there is linearity between the hour of operation and the log odds of in-hospital complications. Image 19) shows there is no -1/+1 correlation between the numerical predictors therefore no perfect multicollinearity is present.

# Results

```{r, echo=FALSE}
modelData <- SurgeryTiming%>% 
  mutate(mort30 = case_when(mort30 == "Yes" ~ 1,
                               mort30 == "No" ~ 0,
                               TRUE ~ 0),
         complication=case_when(complication == "Yes"~1,
                                complication == "No"~0,
                                TRUE ~0))
```

```{r, echo=FALSE}
set.seed(123)
model1 <- glm(mort30 ~ mortality_rsi+ccsMort30Rate+hour+dow+age+bmi+asa_status+baseline_charlson, data = modelData, family = "binomial")

rownames1 = c("(Intercept)", "Risk Stratification Index (30-Day Mortality)", "Overall Incidence of 30-Day Mortality for Each AHRQ-CCS Procedure Category", "Hour of Operation", "day:Monday", "day:Thursday", "day:Tuesday", "day:Wednesday","Age","Body Mass Index","ASA Physical Status:I-II","ASA Physical Status:III", "ASA Physical Status:IV-VI", "Charlson Comorbidity Index")

output1 = summary(model1)$coeff
rownames(output1) = rownames1

kable(output1, digits = 3, caption = "30-Day Mortality Model Coefficients/Summary Stats") %>%
 kable_styling(latex_options = "HOLD_position", font_size=5.8)
```

The results of the model in which 30-day mortality is the response variable show that the only statistically significant predictors in the model are the Risk Stratification Index (30-day mortality), the Overall Incidence of 30-Day Mortality for each AHRQ-CCS Procedure Category, and the patient's age. This model shows that after adjusting for critical risk factors, the variability of whether a patient experiences 30-day mortality after a surgical case is not significantly explained by the day of the week or the hour in which the operation took place. In terms of the `hour` of operation coefficient, the model shows that for each additional hour in a workday, the log-odds of a patient experiencing 30-day mortality after an operation are expected to increase by 0.043, holding all other predictors constant. Furthermore, for each additional hour in a workday, the odds of a patient experiencing 30-day mortality after an operation are expected to multiply by a factor of approximately 1.044 (exp(0.043)) holding all other predictors constant. This means that the general odds a patient results in 30-day mortality increase as the workday progresses. Since the baseline for the `day of the week` variable is Friday, it is best to interpret the Monday coefficient to gauge the differences between the beginning of the week and the end of the week. The log-odds of a patient having 30-day mortality after an operation are expected to be 0.088 less on Mondays than on Fridays, holding other predictors constant. Furthermore, the odds of a patient having 30-day mortality on Mondays is expected to be 0.916 (exp(-0.088)) times the odds of that on Fridays, holding all else constant. This means the odds of a patient having 30-day mortality are a bit lower at the beginning of the week than at the end of the week.

```{r, echo=FALSE}
set.seed(123)
model2 <- glm(complication ~ complication_rsi+ccsComplicationRate+hour+dow+age+bmi+asa_status+baseline_charlson, data = modelData, family = "binomial")

rownames2 = c("(Intercept)", "Risk Stratification Index (In-Hospital Complications)", "Overall Incidence of In-Hospital Complications for Each AHRQ-CCS Procedure Category", "Hour of Operation", "day:Monday", "day:Thursday", "day:Tuesday", "day:Wednesday","Age","Body Mass Index","ASA Physical Status:I-II","ASA Physical Status:III", "ASA Physical Status:IV-VI", "Charlson Comorbidity Index")

output2 = summary(model2)$coeff
rownames(output2) = rownames2

kable(output2, digits = 3, caption = "In-Hospital Complications Model Coefficients/Summary Stats") %>%
 kable_styling(latex_options = "HOLD_position", font_size=6)
```

The results of the model in which in-hospital complication is the response variable show that the only statistically significant predictors in the model are the Risk Stratification Index (in-hospital complication), the Overall Incidence of In-Hospital Complication for each AHRQ-CCS Procedure Category, the days of the week Tuesday and Friday, the patient's age, and the patient's BMI. This model shows that after adjusting for critical risk factors, the variability of whether a patient experiences in-hospital complication is somewhat significantly explained by the day of the week but not the hour in which the operation took place. In terms of the `hour` of operation coefficient, the model shows that for each additional hour in a workday, the log odds of a patient experiencing in-hospital complication are expected to decrease by 0.004, holding all other predictors constant. Furthermore, for each additional hour in a workday, the odds of a patient experiencing in-hospital complications are expected to multiply by a factor of approximately 0.996 (exp(-0.004)) holding all other predictors constant. This means that the general odds a patient results in in-hospital complications roughly stay the same as the workday progresses. In terms of the Monday `day of the week` variable, the log odds of a patient having in-hospital complications are expected to be 0.061 less on Mondays than on Fridays, holding other predictors constant. Furthermore, the odds of a patient having in-hospital complications on Mondays are expected to be about 0.941 (exp(-0.061)) times the odds of on Fridays, holding all else constant. This means the odds of a patient having in-hospital complications are slightly lower at the beginning of the week than at the end of the week.

# Discussion

**1) Hour of Operation & 30-Day Mortality**

In terms of EDA, the box plots displaying the relationship between the hour of operation and the status of 30-day mortality in Image 15A) show that the patients whose operations result in a 30-day mortality status had operations that took place in hours of a slightly later range than patients whose operations did not result in a 30-day mortality status. Also recalling the *Summary Statistics of Case Frequencies* table above, the distribution of most operations happened in the morning, so it is noteworthy that even though a small proportion of operation cases happened later in the day, they still largely comprised of patients resulting in a 30-day mortality cases in comparison to patients who did not result in 30-day mortality. (Appendix: Image 9) Though the logistic regression model deemed the hour of operation not a statistically significant predictor in the variability of patients' 30-day mortality status, the model still showed that the general odds a patient results in 30-day mortality do increase as the workday day progresses. Overall, this shows that there is an association between the hour of an operation and whether or not a patient result in having 30-mortality. Though this association is not statistically significant, given the context of operations being high stakes and the response variable being a critical measure of one's life, it is imperative to highlight the relationship found between hour of operation and 30-day mortality.

**1) Day of Week & 30-Day Mortality**

In the EDA, the bar plots displaying the relationship between the day of the week and the status of 30-day mortality in Image 16A) show slight decreases in the number of patients who do not have 30-day mortality as the week progresses up until Friday. But it is also noteworthy that this pattern matches the decrease in the total patient population (Appendix: Image 10) as well as the decrease in percentages of the total patient population as seen in the *Summary Statistics of Case Frequencies* table above. This means the EDA shows there is not a visible relationship between the 30-day mortality status and the day of the week, only the number of patients and the day of the week. The logistic model deemed the day of the week not a statistically significant predictor in the variability of patients' 30-day mortality status but the model still showed there was a slight decrease in the odds of a patient having 30-day mortality as the week progresses. This may be worth noting given the context of this study being a high-risk environment.

**2) Hour of Operation & In-Hospital Complications**

The EDA of Image 15B) shows box plots of the relationship between the hour of operation and the status of patients' in-hospital complications. This image shows that the hours of operations for both statuses take place at relatively the same range of time. This means that there is not a very visible association between the time of operation and whether or not a patient experiences in-hospital complications. The logistic regression model did not express the hour of operation to be a statistically significant predictor in the variability of patients' in-hospital complication status. The model also expressed that the general odds a patient experiences in-hospital complication roughly stays the same as the workday progresses which is reflected in the EDA. Overall, this shows that there is not a noteworthy association between the hour of an operation and whether or not a patient experiences in-hospital complications.

**2) Day of Week & In-Hospital Complications**

In terms of EDA, Image 16B) shows bar plots of the relationship between the day of the week and the status of in-hospital complications. There looks to be a decreasing number of patients without in-hospital complications as the week goes on up until Friday. The visual also shows slight decreases in the number of patients with in-hospital complications as the week progresses except on Wednesday. The pattern in the number of patients without in-hospital complications aligns with the pattern in the total patient population by day of the week (Appendix: Image 10) as well as the pattern in percentages of the total patient population as seen in the *Summary Statistics of Case Frequencies* table above. However, the pattern in the number of patients with in-hospital complications on the different days of the week displays some differences. This means the EDA shows there is somewhat of a visible relationship between the in-hospital complications status and the day of the week. This aligns with the logistic regression model that shows Tuesday and Friday being statistically significant predictors of the variability of in-hospital complication where the odds of a patient experiencing in-hospital complication is lower on Tuesdays than on Fridays. Overall, this shows that there is a significant association between the day of the week of the operation and whether or not a patient experiences in-hospital complications.

**Methodology Evaluation**

To assess the validity of my methodology process, I assessed the accuracy of my logistic regression models. The accuracy score for the model in which 30-day mortality was the response variable is 0.9962, meaning the model did a great job of classifying patients' 30-day mortality status based on the model choice and predictors used. The accuracy score for the in-hospital complications model was lower at 0.8629 meaning the model did relatively well in classifying patients' in-hospital complication status with the model. Another good metric of accuracy is the model sensitivity since it measures how many classifications were correct out of all the patients that actually had 30-day mortality or in-hospital complications. This is crucial because, in the context of possible death or critical complications, it is imperative to find out all patients who are likely at risk. The sensitivity score for both models is approximately 0.99 which is very helpful in terms of accurately classifying those who do have a positive mortality and complication status. (Appendix: Image 20A and 20B) I also produced PR curves to display the relationship between the sensitivity and specificity which displays the models being more in favor of the recall (sensitivity) than the precision (specificity) which is best given the fact that the context strives more for a higher sensitivity. (Appendix: Image 21A and 21B)

An alternative method that could have been useful would have been utilizing a logistic mixed model to account for the clustering effect that may be produced by patients being treated by the same surgeon but the surgeon data was not provided in this data set.

**Limitation, Implications, and Conclusions**

One limitation that this data provides is that it is not representative of the typical population. Though the data may reflect a population of patients who need surgeries in Cleveland, demographic factors and health descriptors such as race, age, BMI, and disease/disorder statuses were not equally stratified nor close to the general average. This makes the models less generalizable to other patient populations. Another limitation is that the data is quite outdated. There are possible changes in medical demand, surgical practices, diagnostic criteria, as well as treatment options in the past 13 years that make this study less applicable right now. Lastly, the data does not provide a metric that measures the start time of the surgeon's shift to accurately account for previous labor in the day.

This study has provided evidence that there is a slight association between whether a patient experiences a 30-day mortality status of a patient and the hour in which they receive an operation as well as a statistically significant association between whether a patient experiences in-hospital complications and the day on which they receive the operation. More specifically, the increase in the odds of having a positive mortality status increase slightly as the workday progresses and there is an increase in the odds of a patient's complication status in some of the later weekdays. Therefore this study indicates the possible negative effects of a surgeon's extended workshift and workweek. If given the chance to approach this study differently, I'd consider incorporating data from other clinics with more diverse patient profiles to make a model that reflects broader cases. I'd also incorporate profile data on the surgeon running each operation to account for variability in the response relating to surgical errors, experience level, and previous hours worked before the current patient. Altogether, this study provides insight into the relationship between surgical cases over metrics of time that would assist researchers and medical leaders in further understanding the detrimental outcomes of continuous extensive medical labor.

\pagebreak

# Appendix

## Extra EDA Visuals

```{r ageGraph, echo=FALSE}
one <- ggplot(data = SurgeryTiming, aes(x = age)) + geom_density(fill = "skyblue", color = "black", alpha = 0.7) +labs(title = "1) Age Density Plot",
       x = "Age",
       y = "Density") +xlim(c(0,100)) +
  theme(legend.position = "none",
        plot.title = element_text(size = 7),
        plot.subtitle = element_text(size = 6),
        axis.text = element_text(size = 5),
        axis.title = element_text(size = 6))

```

```{r genderGraph, echo=FALSE}
two <- ggplot(SurgeryTiming, aes(x = gender, fill = gender)) + geom_bar() + labs(title = "2) Distribution of Gender", fill = "Gender", x = "Gender")+
  theme(legend.position = "none",
        plot.title = element_text(size = 7),
        plot.subtitle = element_text(size = 6),
        axis.text = element_text(size = 5),
        axis.title = element_text(size = 6))

```

```{r raceGraph, echo=FALSE}
three <- ggplot(SurgeryTiming, aes(x = race, fill = race)) + geom_bar() + labs(title = "3) Distribution of Race", fill = "Race", x = "Race", y = "Count")+
  theme(legend.position = "none",
        plot.title = element_text(size = 7),
        plot.subtitle = element_text(size = 6),
        axis.text = element_text(size = 5),
        axis.title = element_text(size = 6))

```

```{r asaGraph, echo=FALSE}
four <- ggplot(SurgeryTiming, aes(x = asa_status, fill = asa_status)) + geom_bar() + labs(title = "4) Distribution of ASA Physical Status", fill = "ASA Physical Status", x = "ASA Physical Status", y = "Count")+coord_flip() +
  theme(legend.position = "none",
        plot.title = element_text(size = 7),
        plot.subtitle = element_text(size = 6),
        axis.text = element_text(size = 5),
        axis.title = element_text(size = 6))
```

```{r, echo=FALSE}
plot_grid(one, two, three, four, ncol=2, rel_heights = c(1.1, 2))
```

*Image 1) Age*

Since the distribution of the patients' age is relatively normal and unimodal and not really that skewed to the left the best summary statistic is the mean and the best metric of spread is the standard deviation.

*Image 2) Gender*

There appears to be a bit more operation cases done on women than men.

*Image 3) Race*

There are multidude more operation cases done on Caucasian patients than any other racial demographics.

*Image 4) ASA Physical Status*

\*Note: ASA classification uses a grading system of I (one) through V (five) I identifying a person in good health and V as a person with a severe, life-threatening condition. The sixth (VI) status identifies deceased organ donors.

Most patients of operation cases reside in the I-II ASA status and then the III status comes in a close second. There are not many patients that reside in the IV-VI status.

```{r echo=FALSE}
five <- ggplot(data = SurgeryTiming, aes(x = bmi)) + geom_density(fill = "purple", color = "black", alpha = 0.7) +labs(title = "5) BMI Density Plot",
       x = "BMI",
       y = "Density")+
  theme(legend.position = "none",
        plot.title = element_text(size = 7),
        plot.subtitle = element_text(size = 6),
        axis.text = element_text(size = 5),
        axis.title = element_text(size = 6))
```

```{r echo=FALSE}
six <- ggplot(SurgeryTiming, aes(x = baseline_charlson)) + geom_bar() + labs(title = "6) Distribution of Charlson Comorbidity Index", x = "Charslon Comorbidity Index", y = "Count") +
  theme(legend.position = "none",
        plot.title = element_text(size = 7),
        plot.subtitle = element_text(size = 6),
        axis.text = element_text(size = 5),
        axis.title = element_text(size = 6))
```

```{r echo=FALSE}
seven <- ggplot(data = SurgeryTiming, aes(x = mortality_rsi)) + geom_density(fill = "pink", color = "black", alpha = 0.7) +labs(title = "7) Distribution of Risk Stratification Index (30-Day Mortality)",
       x = "Risk Stratification Index (30-Day Mortality)",
       y = "Density") +
  theme(legend.position = "none",
        plot.title = element_text(size = 7),
        plot.subtitle = element_text(size = 6),
        axis.text = element_text(size = 5),
        axis.title = element_text(size = 6))
```

```{r echo=FALSE}
eight <- ggplot(data = SurgeryTiming, aes(x = complication_rsi)) + geom_density(fill = "cornflowerblue", color = "black", alpha = 0.7) +labs(title = "8) Distribution of Risk Stratification Index (In-Hospital Complications)",
       x = "Risk Stratification Index (In-Hospital Complications)",
       y = "Density") +
  theme(legend.position = "none",
        plot.title = element_text(size = 7),
        plot.subtitle = element_text(size = 6),
        axis.text = element_text(size = 5),
        axis.title = element_text(size = 6))
```

```{r, echo=FALSE}
plot_grid(five, six, seven, eight, ncol=2, rel_heights = c(2, 2))
```

*Image 5) BMI*

Since the distribution of the patients' BMI is slightly skewed to the right the best summary statistic is the median and the best metric of spread is the IQR.

*Image 6) Charlson Comorbidity Index*

\*Note: The Charlson comorbidity index (CCI) is the most widely used comorbidity index used to determine survival rate (1yr and 10yr) in patient with multiple comorbidities. As the CCI level increases the probability of one year of survival decreases.

Since the distribution of the patients' Charlson Comorbidity Index is skewed to the right the best summary statistic is the median and the best metric of spread is the IQR.

*Image 7) Risk Stratification Index (30-Day Mortality)*

\*Note: The Risk Stratification Index (RSI) is an open source, nationally validated, risk stratification methodology that permits outcomes such as duration of hospitalization and mortality to be compared equally across institutions.

The density chart of the distribution of RSI (30-day mortality) is multimodal and skewed to the left so the median and IQR would be more accurate measures of center and spread.

*Image 8) Risk Stratification Index (In-Hospital Complications)*

The density chart of the distribution of RSI (in-hospital complications) is multimodal and skewed to the left so the median and IQR would be more accurate measures of center and spread.

```{r echo = FALSE}
nine <- ggplot(data = SurgeryTiming, aes(x = hour)) + geom_density(fill = "coral", color = "black", alpha = 0.7) +labs(title = "9) Distribution of Operation Time",
       x = "Operation Time)",
       y = "Density") +
  theme(legend.position = "none",
        plot.title = element_text(size = 7),
        plot.subtitle = element_text(size = 6),
        axis.text = element_text(size = 5),
        axis.title = element_text(size = 6))
```

```{r echo = FALSE}
SurgeryTiming$dow <- factor(SurgeryTiming$dow, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday"))
ten <-ggplot(SurgeryTiming, aes(x = dow, fill = dow)) + geom_bar() + labs(title = "10) Distribution of Day of the Week", fill = "Day of the Week", x = "Day of the Week", y = "Count") + theme(aspect.ratio = 1,axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(legend.position = "none",
        plot.title = element_text(size = 7),
        plot.subtitle = element_text(size = 6),
        axis.text = element_text(size = 5),
        axis.title = element_text(size = 6))
```

```{r echo = FALSE}
SurgeryTiming$month <- factor(SurgeryTiming$month, levels = c("January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"))


eleven <- ggplot(SurgeryTiming, aes(x = month)) + geom_bar() + labs(title = "11) Distribution of Month of Year", x = "Month of Year", y = "Count") +
  theme(aspect.ratio = 1, axis.text.x = element_text(angle = 45, hjust = 1),legend.position = "none",
        plot.title = element_text(size = 7),
        plot.subtitle = element_text(size = 6),
        axis.text = element_text(size = 5),
        axis.title = element_text(size = 6))
```

```{r echo = FALSE}
SurgeryTiming$moonphase <- factor(SurgeryTiming$moonphase, levels = c("New Moon", "February", "First Quarter", "Full Moon", "Last Quarter"))

twelve <- ggplot(SurgeryTiming, aes(x = moonphase)) + geom_bar() + labs(title = "12) Distribution of Moon Phases", x = "Phase of Moon", y = "Count") +
  theme(aspect.ratio = 1, axis.text.x = element_text(angle = 45, hjust = 1),legend.position = "none",
        plot.title = element_text(size = 7),
        plot.subtitle = element_text(size = 6),
        axis.text = element_text(size = 5),
        axis.title = element_text(size = 6))
```

```{r, echo=FALSE}
plot_grid(nine, ten, eleven, twelve, ncol=2, rel_heights = c(2, 2))
```

*Image 9) Operation Hour*

The distribution is bi-modal with a huge concentration of operation hours at around 8:00 am and a much smaller concentration at 12:30 pm.

*Image 10) Day of the Week*

The distribution of the days the of operation cases tend have a higher concentration in the beginning of the week.

*Image 11) Month of the Year*

The distribution of the months of operation cases show peaks in June and near the end of the summer (August and September).

*Image 12) Phase of Moon*

The distribution of the moon phases of operation cases show a relatively uniform distribution with the least cases occuring during new moon phases.

```{r, echo=FALSE}
ggplot(SurgeryTiming, aes(x = ahrq_ccs)) + geom_bar() + labs(title = "13) Distribution of AHRQ-CCS Procedure Category", x = "AHRQ-CCS Procedure Category", y = "Count") + 
  theme(aspect.ratio = 1,
        axis.text.x = element_text( hjust = 1, size=5), 
        plot.title = element_text(size = 9),
        legend.position = "none",
        plot.subtitle = element_text(size = 6),
        axis.text = element_text(size = 5),
        axis.title = element_text(size = 6)) +coord_flip()
```

*Image 13) AHRQ-CCS Procedure Category*

The distribution of procedure type shows there are multiple sporadic procedure types that have very high concentrations of operations and multiple that have low concentrations.

```{r, echo=FALSE}
fourteenA <- ggplot(SurgeryTiming, aes(x =mort30, y = age, fill = mort30)) + geom_boxplot() + labs(title = "14A) Age vs 30-Day Mortality", x = "30 Day Mortality", y = "Age", fill = "30 Day Mortality") +theme(aspect.ratio = 1,legend.position = "none",
        plot.title = element_text(size = 6),
        plot.subtitle = element_text(size = 6),
        axis.text = element_text(size = 5),
        axis.title = element_text(size = 6))+coord_flip()
fourteenB <- ggplot(SurgeryTiming, aes(x =complication, y = age, fill = complication)) + geom_boxplot() + labs(title = "14B) Age vs In-Hospital Complication", x = "In-Hospital Complication", y = "Age", fill = "In-Hospital Complication") +theme(aspect.ratio = 1,legend.position = "none",
        plot.title = element_text(size = 6),
        plot.subtitle = element_text(size = 6),
        axis.text = element_text(size = 5),
        axis.title = element_text(size = 6)) +coord_flip()
```

```{r, echo=FALSE}
fifteenA <- ggplot(SurgeryTiming, aes(x =mort30, y = hour,fill = mort30)) + geom_boxplot() + labs(title = "15A) Hour of Operation vs 30-Day Mortality", x = "30 Day Mortality", y = "Hour of Operation", fill = "30 Day Mortality") +theme(aspect.ratio = 1,legend.position = "none",
        plot.title = element_text(size = 6),
        plot.subtitle = element_text(size = 6),
        axis.text = element_text(size = 5),
        axis.title = element_text(size = 6))+coord_flip()
fifteenB <- ggplot(SurgeryTiming, aes(x =complication, y = hour,fill = complication)) + geom_boxplot() + labs(title = "15B) Hour of Operation vs In-Hospital Complication", x = "In-Hospital Complication", y = "Hour of Operation", fill = "In-Hospital Complication") +theme(aspect.ratio = 1,legend.position = "none",
        plot.title = element_text(size = 6),
        plot.subtitle = element_text(size = 6),
        axis.text = element_text(size = 5),
        axis.title = element_text(size = 6)) +coord_flip()

```

```{r, echo=FALSE}
plot_grid(fourteenA ,fourteenB, fifteenA,fifteenB, ncol=2, rel_heights = c(2, 2))
```

*Image 14) Age vs 30 Day Morality and Age vs In-Hospital Complication*

The first box plot shows that patients that have 30-day mortality are more generally of an older age than patients who do not have 30-day mortality. The second box plot shows that patients that have in-hospital complications tend to be only slighty older than those who do not.

*Image 15) Hour vs 30 Day Morality and Hours vs In-Hospital Complication*

The first box plot shows that operations of patients that have 30-day mortality tend to happen later in the day than operations of patients that do not have 30-day mortality. The second boxplot shows that operations of patients that have in-hospital complications tend to be relatively around the same hour in the day as operations of patients that do not have in-hospital complications.

```{r, echo=FALSE}
sixteenA <- ggplot(data=SurgeryTiming, aes(x=mort30,fill = mort30)) +
    geom_bar() + labs(title = '16A) Day of Operation vs 30-Day Mortality', x = '30-Day Mortality', y = 'Count', fill = "30 Day Mortality")+facet_wrap(~dow)+theme(aspect.ratio = 1,legend.position = "none",
        plot.title = element_text(size = 7),
        plot.subtitle = element_text(size = 6),
        axis.text = element_text(size = 5),
        axis.title = element_text(size = 6))

sixteenB <- ggplot(data=SurgeryTiming, aes(x=complication,fill = complication)) +
    geom_bar() + labs(title = '16B) Day of Operation vs In-Hospital Complication', x = 'In-Hospital Complication', y = 'Count', fill = "In-Hospital Complication")+facet_wrap(~dow)+theme(aspect.ratio = 1,legend.position = "none",
        plot.title = element_text(size = 7),
        plot.subtitle = element_text(size = 6),
        axis.text = element_text(size = 5),
        axis.title = element_text(size = 6))
```

```{r, echo=FALSE}
plot_grid(sixteenA , sixteenB, ncol=2, rel_heights = c(2, 2))
```

*Image 16) Day of Week vs 30 Day Mortality and Day of the Week vs In-Hospital Complication*

In bar plot 16A) there is a noticeably decreasing number of patients without 30-day mortality as the week goes on. In bar plot 16B) there is also a decreasing number of patients without in-hospital complication as the week goes on.

## Model Diagnostics

*Image 17) Linearity: Logit Plot of Hour of Operation vs 30-Day Mortality*

```{r, echo=FALSE}
emplogitplot1(mort30 ~ hour, data = modelData, ngroups = 10)
```

*Image 18) Linearity: Logit Plot of Hour of Operation vs In-Hospital Complication*

```{r, echo=FALSE}
emplogitplot1(complication ~ hour, data = modelData, ngroups = 10)
```

*Image 19) Multicollinearity: Correlation Matrix*

```{r, echo=FALSE}
cor_matrix <- cor(modelData[, c("mortality_rsi","ccsMort30Rate","hour","age","bmi","baseline_charlson")])
# Print the correlation matrix
cor_matrix
```

## Model Accuracy Check

*Image 20A) Confusion Matrix and Summary Statistics for 30-Day Mortality Model*

```{r, echo=FALSE}
#30-DAY MORTALITY
cleanedData <- na.omit(modelData)
set.seed(123) 
mort30_data <- cleanedData[, c("mortality_rsi","ccsMort30Rate","hour","dow","age","bmi","asa_status","baseline_charlson", "mort30")]
index1 <- createDataPartition(mort30_data$mort30, p = 0.8, list = FALSE)
train_mort30 <- mort30_data[index1, ]
test_mort30 <- mort30_data[-index1, ]
checkModel_mort30 <- glm(mort30 ~ mortality_rsi+ccsMort30Rate+hour+dow+age+bmi+asa_status+baseline_charlson, data = train_mort30, family = "binomial")
predict_mort30 <- predict(checkModel_mort30, newdata = test_mort30, type = "response")

#Confusion matrix
predicted_classes_mort30 <- ifelse(predict_mort30> 0.5, 1, 0)

# Create a confusion matrix 
confMatrix_mort30 <- confusionMatrix(table(predicted_classes_mort30, test_mort30$mort30))
print(confMatrix_mort30)
```

*Image 20B) Confusion Matrix and Summary Statistics for In-Hospital Complications*

```{r, echo=FALSE}
#IN-HOSPITAL COMPLICATIONS    
set.seed(123) 
complication_data <- cleanedData[, c("complication_rsi","ccsComplicationRate","hour","dow","age","bmi","asa_status","baseline_charlson", "complication")]
index2 <- createDataPartition(complication_data$complication, p = 0.8, list = FALSE)
train_complication <- complication_data[index2, ]
test_complication <- complication_data[-index2, ]
checkModel_complication <- glm(complication ~ complication_rsi+ccsComplicationRate+hour+dow+age+bmi+asa_status+baseline_charlson, data = train_complication, family = "binomial")
predict_complication <- predict(checkModel_complication, newdata = test_complication, type = "response")

#Confusion matrix
predicted_classes_complication <- ifelse(predict_complication> 0.5, 1, 0)

# Create a confusion matrix 
confMatrix_complication <- confusionMatrix(table(predicted_classes_complication, test_complication$complication))
print(confMatrix_complication)
```

*Image 21A) Precision-Recall (PR) curves) for 30-Day Mortality Model*

```{r, echo=FALSE}
predictProbs_mort30 <- predict(checkModel_mort30, type = "response")
pr_curve1 <- pr.curve(train_mort30$mort30, predictProbs_mort30, curve = TRUE)
plot(pr_curve1, main = "Precision-Recall Curve for 30-Day Mortality", col = "blue", lwd = 2)
```

*Image 21B) Precision-Recall (PR) curves for In-Hospital Complications*

```{r, echo=FALSE}
predictProbs_complication<- predict(checkModel_complication, type = "response")
pr_curve2 <- pr.curve(train_complication$complication, predictProbs_complication, curve = TRUE)
plot(pr_curve2, main = "Precision-Recall Curve for In-Hospital Complications", col = "red", lwd = 2)
```

## Work Cited

-   Alhola, Paula, and Päivi Polo-Kantola. "Sleep deprivation: Impact on cognitive performance." Neuropsychiatric disease and treatment vol. 3,5 (2007): 553-67.
-   Džakula, Aleksandar, and Danko Relić. "Health workforce shortage - doing the right things or doing things right?." Croatian Medical Journal vol. 63,2 (2022): 107-109. <doi:10.3325/cmj.2022.63.107>
-   Sessler et al."Operation Timing and 30-Day Mortality After Elective GeneralSurgery". Anesth Analg 2011; 113: 1423-8
-   Sessler, Daniel I., et al. "Operation timing and 30-day mortality after elective general surgery." Anesthesia & Analgesia, vol. 113, no. 6, 2011, pp. 1423--1428, <https://doi.org/10.1213/ane.0b013e3182315a6d>.
